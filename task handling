<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Activity Tracker">
    <title>Daily Activity Tracker</title>
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkRhaWx5IEFjdGl2aXR5IFRyYWNrZXIiLAogICJzaG9ydF9uYW1lIjogIkFjdGl2aXR5IiwKICAic3RhcnRfdXJsIjogIi8iLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiMwMDAwMDAiLAogICJ0aGVtZV9jb2xvciI6ICIjMDAwMDAwIiwKICAiaWNvbnMiOiBbCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpTVRJNElpQm9aV2xuYUhROUlqRXlPQ0lnZG1sbGQwSnZlRDBpTUNBd0lERXlPQ0F4TWpnaUlIaHRiRzV6UFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eU1EQXdMM04yWnlJK1BHTnBjbU5zWlNCamVEMGlOalFpSUdONVBTSTJOQ0lnY2owaU5EQWlJR1pwYkd3OUlpTTJOamRsWldFaUx6NDhkR1Y0ZENCNFBTSTJOQ0lnZVQwaU56UWlJR1pwYkd3OUlpTm1abVlpSUdadmJuUXRjMmw2WlQwaU16QWlJSFJsZUhRdFlXNWphRzl5UFNKdGFXUmtiR1VpUGp3dmRHVjRkRDQ4TDNOMlp6ND0iLAogICAgICAic2l6ZXMiOiAiMTI4eDEyOCIsCiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiCiAgICB9CiAgXQp9">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #000000;
            min-height: 100vh;
            padding: 10px;
            padding-bottom: 80px;
            overflow-x: hidden;
        }

        .install-prompt {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #667eea;
            color: white;
            padding: 15px 25px;
            border-radius: 30px;
            display: none;
            align-items: center;
            gap: 10px;
            z-index: 3000;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.5);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateX(-50%) translateY(100px); opacity: 0; }
            to { transform: translateX(-50%) translateY(0); opacity: 1; }
        }

        .install-prompt button {
            background: white;
            color: #667eea;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.8em;
        }

        .year-countdown {
            text-align: center;
            font-size: 1em;
            color: #999;
            margin-bottom: 15px;
            font-weight: 500;
        }

        .year-countdown .time-unit {
            color: #667eea;
            font-size: 1.5em;
            font-weight: bold;
            margin: 0 3px;
        }

        .year-countdown .label {
            font-size: 0.85em;
            color: #666;
        }

        .custom-goal-section {
            text-align: center;
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 15px;
        }

        .goal-input-section {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 10px;
        }

        .goal-input-section input {
            padding: 12px;
            border: 2px solid #667eea;
            border-radius: 10px;
            font-size: 14px;
            background: white;
            width: 100%;
        }

        .goal-buttons {
            display: flex;
            gap: 10px;
        }

        .goal-buttons button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            transition: all 0.3s;
        }

        .goal-title {
            font-size: 1.1em;
            color: #667eea;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .goal-timer {
            font-size: 1.2em;
            color: #667eea;
            font-weight: bold;
        }

        .goal-timer .time-unit {
            color: #667eea;
            font-size: 1em;
            margin: 0 2px;
        }

        .goal-timer .label {
            font-size: 0.75em;
            color: #999;
        }

        .theme-selector {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9ff;
            border-radius: 10px;
        }

        .theme-selector label {
            font-weight: bold;
            color: #333;
            font-size: 14px;
        }

        .theme-selector select {
            padding: 10px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            width: 100%;
        }

        #customColorPicker {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        #customColorPicker label {
            font-size: 12px;
            color: #666;
            flex: 0 0 70px;
        }

        #customColorPicker input[type="color"] {
            flex: 1;
            min-width: 60px;
            height: 40px;
            border: 2px solid #667eea;
            border-radius: 8px;
            cursor: pointer;
        }

        .add-task-section {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }

        .add-task-section input {
            padding: 14px;
            border: 2px solid #667eea;
            border-radius: 10px;
            font-size: 15px;
        }

        .add-task-section button {
            padding: 14px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 15px;
            font-weight: bold;
            transition: background 0.3s;
        }

        .add-task-section button:active {
            background: #5568d3;
            transform: scale(0.98);
        }

        .task-item {
            background: #f8f9ff;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 12px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .task-name {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
        }

        .timer-section {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
            margin-bottom: 12px;
        }

        .timer-section input {
            width: 70px;
            padding: 10px 8px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 14px;
            text-align: center;
        }

        .timer-display {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
            font-family: 'Courier New', monospace;
            flex: 1 1 100%;
            text-align: center;
            margin-top: 8px;
        }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
            font-size: 13px;
        }

        .btn:active {
            transform: scale(0.95);
        }

        .btn-start {
            background: #48bb78;
            color: white;
        }

        .btn-stop {
            background: #f56565;
            color: white;
        }

        .btn-reset {
            background: #ed8936;
            color: white;
        }

        .completion-section {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 2px solid #e2e8f0;
        }

        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox-wrapper input[type="checkbox"] {
            width: 22px;
            height: 22px;
            cursor: pointer;
        }

        .checkbox-wrapper label {
            cursor: pointer;
            user-select: none;
            font-size: 14px;
        }

        .notes-input {
            padding: 12px;
            border: 2px solid #cbd5e0;
            border-radius: 8px;
            font-size: 14px;
            width: 100%;
        }

        .countdown-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .countdown-text {
            font-size: 6em;
            color: white;
            font-weight: bold;
            animation: pulse 1s ease-in-out;
        }

        @keyframes pulse {
            0% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }

        .celebration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(102, 126, 234, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .celebration-text {
            font-size: 5em;
            color: white;
            font-weight: bold;
            animation: celebrate 0.6s ease-in-out;
        }

        @keyframes celebrate {
            0% { transform: scale(0) rotate(0deg); }
            50% { transform: scale(1.2) rotate(10deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        .completed {
            background: #c6f6d5 !important;
        }

        .partial {
            background: #fef3c7 !important;
        }

        .delete-btn {
            background: #fc8181;
            color: white;
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 13px;
        }

        .delete-btn:active {
            background: #f56565;
            transform: scale(0.95);
        }

        .analytics-btn {
            background: #667eea;
            color: white;
            padding: 16px 30px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            margin: 20px auto;
            display: block;
            width: 100%;
            transition: all 0.3s;
        }

        .analytics-btn:active {
            background: #5568d3;
            transform: scale(0.98);
        }

        .analytics-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            overflow-y: auto;
            padding: 20px;
        }

        .analytics-content {
            background: white;
            padding: 20px;
            border-radius: 20px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .analytics-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .analytics-header h2 {
            color: #667eea;
            font-size: 1.5em;
        }

        .close-btn {
            background: #f56565;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: #f8f9ff;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #666;
            margin-top: 5px;
            font-size: 0.9em;
        }

        .chart-container {
            margin: 20px 0;
            background: #f8f9ff;
            padding: 15px;
            border-radius: 12px;
        }

        .chart-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
            margin-bottom: 12px;
        }

        .suggestions-section, .compliments-section, .partial-reasons-section {
            padding: 15px;
            border-radius: 12px;
            margin: 15px 0;
        }

        .suggestions-section {
            background: #e6f7ff;
        }

        .compliments-section {
            background: #f6ffed;
        }

        .partial-reasons-section {
            background: #fff7e6;
        }

        .suggestions-section h3 {
            color: #1890ff;
            margin-bottom: 12px;
            font-size: 1.1em;
        }

        .compliments-section h3 {
            color: #52c41a;
            margin-bottom: 12px;
            font-size: 1.1em;
        }

        .partial-reasons-section h3 {
            color: #fa8c16;
            margin-bottom: 12px;
            font-size: 1.1em;
        }

        .suggestion-item, .compliment-item, .partial-reason-item {
            background: white;
            padding: 10px;
            margin: 8px 0;
            border-radius: 8px;
            font-size: 0.95em;
        }

        .suggestion-item {
            border-left: 4px solid #1890ff;
        }

        .compliment-item {
            border-left: 4px solid #52c41a;
            font-weight: 500;
        }

        .partial-reason-item {
            border-left: 4px solid #fa8c16;
        }

        @media (max-width: 480px) {
            .countdown-text {
                font-size: 4em;
            }
            .celebration-text {
                font-size: 3em;
            }
        }
    </style>
</head>
<body>
    <div class="install-prompt" id="installPrompt">
        <span>üì± Install this app!</span>
        <button onclick="installApp()">Install</button>
        <button onclick="dismissInstall()" style="background: transparent; color: white;">Later</button>
    </div>

    <div class="container">
        <h1>Daily Activity Tracker</h1>
        <div class="year-countdown" id="yearCountdown"></div>
        
        <div class="custom-goal-section">
            <div class="goal-input-section">
                <input type="text" id="goalName" placeholder="Enter your goal (e.g., Launch Project)">
                <input type="datetime-local" id="goalDateTime">
                <div class="goal-buttons">
                    <button onclick="setGoal()" style="background: #667eea; color: white;">üéØ Set Goal</button>
                    <button onclick="clearGoal()" style="background: #f56565; color: white;">‚ùå Clear</button>
                </div>
            </div>
            <div class="goal-countdown" id="goalCountdown"></div>
        </div>
        
        <div class="theme-selector">
            <label>üé® Choose Theme:</label>
            <select id="themeSelect" onchange="changeTheme()">
                <option value="custom">Custom Colors</option>
                <option value="dark">Dark Mode</option>
                <option value="purple">Purple Gradient</option>
                <option value="ocean">Ocean Blue</option>
                <option value="sunset">Sunset Orange</option>
                <option value="forest">Forest Green</option>
                <option value="rose">Rose Pink</option>
            </select>
            <div id="customColorPicker" style="display: flex;">
                <label>Primary:</label>
                <input type="color" id="primaryColor" value="#667eea" onchange="applyCustomTheme()">
                <label>Secondary:</label>
                <input type="color" id="secondaryColor" value="#764ba2" onchange="applyCustomTheme()">
                <label>Container:</label>
                <input type="color" id="containerColor" value="#ffffff" onchange="applyCustomTheme()">
            </div>
        </div>
        
        <div class="add-task-section">
            <input type="text" id="newTaskInput" placeholder="Add new activity (e.g., Study, Exercise, Sleep...)">
            <button onclick="addTask()">‚ûï Add Task</button>
        </div>

        <div id="taskList"></div>

        <button class="analytics-btn" onclick="showAnalytics()">üìä View Productivity Analytics</button>
    </div>

    <div class="analytics-modal" id="analyticsModal">
        <div class="analytics-content">
            <div class="analytics-header">
                <h2>üéØ Your Report</h2>
                <button class="close-btn" onclick="closeAnalytics()">‚úï</button>
            </div>

            <div class="stats-grid" id="statsGrid"></div>

            <div class="chart-container">
                <div class="chart-title">Task Completion</div>
                <canvas id="barChart"></canvas>
            </div>

            <div class="chart-container">
                <div class="chart-title">Time Distribution</div>
                <canvas id="pieChart"></canvas>
            </div>

            <div class="compliments-section" id="complimentsSection"></div>
            
            <div class="partial-reasons-section" id="partialReasonsSection"></div>
            
            <div class="suggestions-section" id="suggestionsSection"></div>
        </div>
    </div>

    <div class="countdown-animation" id="countdownAnimation">
        <div class="countdown-text" id="countdownText"></div>
    </div>

    <div class="celebration" id="celebration">
        <div class="celebration-text">üéâ YEAHHH! üéâ</div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <script>
        // PWA Installation
        let deferredPrompt;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installPrompt').style.display = 'flex';
        });

        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    deferredPrompt = null;
                    document.getElementById('installPrompt').style.display = 'none';
                });
            }
        }

        function dismissInstall() {
            document.getElementById('installPrompt').style.display = 'none';
        }

        // Register Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('data:text/javascript;base64,c2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgZSA9PiB7CiAgZS53YWl0VW50aWwoc2VsZi5za2lwV2FpdGluZygpKTsKfSk7CgpzZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ2FjdGl2YXRlJywgZSA9PiB7CiAgZS53YWl0VW50aWwoc2VsZi5jbGllbnRzLmNsYWltKCkpOwp9KTs=');
        }

        const defaultTasks = ['Study', 'Exercise', 'Sleep', 'Meditation'];
        let tasks = [];

        // Calculate remaining days in the year
        function updateYearCountdown() {
            const now = new Date();
            const endOfYear = new Date(now.getFullYear(), 11, 31, 23, 59, 59);
            const diffTime = endOfYear - now;
            
            const days = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diffTime % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diffTime % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diffTime % (1000 * 60)) / 1000);
            
            document.getElementById('yearCountdown').innerHTML = `
                <span class="time-unit">${days}</span><span class="label">d</span>
                <span class="time-unit">${String(hours).padStart(2, '0')}</span><span class="label">h</span>
                <span class="time-unit">${String(minutes).padStart(2, '0')}</span><span class="label">m</span>
                <span class="time-unit">${String(seconds).padStart(2, '0')}</span><span class="label">s</span>
                remaining in ${now.getFullYear()}
            `;
        }

        setInterval(updateYearCountdown, 1000);

        let goalTimer = null;
        let goalData = null;

        function setGoal() {
            const goalName = document.getElementById('goalName').value.trim();
            const goalDateTime = document.getElementById('goalDateTime').value;

            if (!goalName) {
                alert('Please enter a goal name!');
                return;
            }

            if (!goalDateTime) {
                alert('Please select a date and time!');
                return;
            }

            goalData = {
                name: goalName,
                targetDate: new Date(goalDateTime)
            };

            if (goalTimer) {
                clearInterval(goalTimer);
            }

            updateGoalCountdown();
            goalTimer = setInterval(updateGoalCountdown, 1000);
        }

        function updateGoalCountdown() {
            if (!goalData) return;

            const now = new Date();
            const target = goalData.targetDate;
            const diffTime = target - now;

            if (diffTime <= 0) {
                document.getElementById('goalCountdown').innerHTML = `
                    <div class="goal-title">üéâ ${goalData.name}</div>
                    <div class="goal-timer" style="color: #52c41a;">Goal Achieved! üèÜ</div>
                `;
                if (goalTimer) {
                    clearInterval(goalTimer);
                }
                return;
            }

            const years = Math.floor(diffTime / (1000 * 60 * 60 * 24 * 365));
            const days = Math.floor((diffTime % (1000 * 60 * 60 * 24 * 365)) / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diffTime % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diffTime % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diffTime % (1000 * 60)) / 1000);

            let timeDisplay = '';
            if (years > 0) {
                timeDisplay += `<span class="time-unit">${years}</span><span class="label">y</span> `;
            }
            timeDisplay += `
                <span class="time-unit">${days}</span><span class="label">d</span>
                <span class="time-unit">${String(hours).padStart(2, '0')}</span><span class="label">h</span>
                <span class="time-unit">${String(minutes).padStart(2, '0')}</span><span class="label">m</span>
                <span class="time-unit">${String(seconds).padStart(2, '0')}</span><span class="label">s</span>
            `;

            document.getElementById('goalCountdown').innerHTML = `
                <div class="goal-title">üéØ ${goalData.name}</div>
                <div class="goal-timer">${timeDisplay}</div>
            `;
        }

        function clearGoal() {
            if (goalTimer) {
                clearInterval(goalTimer);
            }
            goalData = null;
            document.getElementById('goalCountdown').innerHTML = '';
            document.getElementById('goalName').value = '';
            document.getElementById('goalDateTime').value = '';
        }

        const themes = {
            dark: { primary: '#000000', secondary: '#000000' },
            purple: { primary: '#667eea', secondary: '#764ba2' },
            ocean: { primary: '#2193b0', secondary: '#6dd5ed' },
            sunset: { primary: '#f46b45', secondary: '#eea849' },
            forest: { primary: '#11998e', secondary: '#38ef7d' },
            rose: { primary: '#eb3349', secondary: '#f45c43' }
        };

        function changeTheme() {
            const select = document.getElementById('themeSelect');
            const customPicker = document.getElementById('customColorPicker');
            const theme = select.value;

            if (theme === 'custom') {
                customPicker.style.display = 'flex';
                applyCustomTheme();
            } else {
                customPicker.style.display = 'none';
                const colors = themes[theme];
                applyThemeColors(colors.primary, colors.secondary);
            }
        }

        function applyCustomTheme() {
            const primary = document.getElementById('primaryColor').value;
            const secondary = document.getElementById('secondaryColor').value;
            const container = document.getElementById('containerColor').value;
            applyThemeColors(primary, secondary, container);
        }

        function applyThemeColors(primary, secondary, container = 'rgba(255, 255, 255, 0.95)') {
            document.body.style.background = `linear-gradient(135deg, ${primary} 0%, ${secondary} 100%)`;
            
            const containers = document.querySelectorAll('.container');
            containers.forEach(cont => {
                cont.style.background = container;
            });
            
            const style = document.createElement('style');
            style.id = 'dynamic-theme';
            
            const existingStyle = document.getElementById('dynamic-theme');
            if (existingStyle) {
                existingStyle.remove();
            }

            style.innerHTML = `
                h1 { color: ${primary} !important; }
                .add-task-section input { border-color: ${primary} !important; }
                .add-task-section button { background: ${primary} !important; }
                .timer-section input { border-color: ${primary} !important; }
                .timer-display { color: ${primary} !important; }
                .theme-selector select { border-color: ${primary} !important; }
                #customColorPicker input[type="color"] { border-color: ${primary} !important; }
            `;
            
            document.head.appendChild(style);
        }

        function initializeTasks() {
            defaultTasks.forEach(name => {
                tasks.push({
                    id: Date.now() + Math.random(),
                    name: name,
                    minutes: 0,
                    seconds: 0,
                    timeRemaining: 0,
                    isRunning: false,
                    interval: null,
                    completed: false,
                    partial: false,
                    notes: ''
                });
            });
            renderTasks();
        }

        function addTask() {
            const input = document.getElementById('newTaskInput');
            const taskName = input.value.trim();
            
            if (taskName) {
                tasks.push({
                    id: Date.now(),
                    name: taskName,
                    minutes: 0,
                    seconds: 0,
                    timeRemaining: 0,
                    isRunning: false,
                    interval: null,
                    completed: false,
                    partial: false,
                    notes: ''
                });
                input.value = '';
                renderTasks();
            }
        }

        function deleteTask(id) {
            tasks = tasks.filter(task => task.id !== id);
            renderTasks();
        }

        function startTimer(id) {
            const task = tasks.find(t => t.id === id);
            const minutes = parseInt(document.getElementById(`min-${id}`).value) || 0;
            const seconds = parseInt(document.getElementById(`sec-${id}`).value) || 0;
            
            if (minutes === 0 && seconds === 0) {
                alert('Please set a time!');
                return;
            }

            task.timeRemaining = minutes * 60 + seconds;
            
            showCountdown(() => {
                task.isRunning = true;
                task.interval = setInterval(() => {
                    if (task.timeRemaining > 0) {
                        task.timeRemaining--;
                        updateTimerDisplay(id);
                    } else {
                        stopTimer(id);
                        showCelebration();
                    }
                }, 1000);
                renderTasks();
            });
        }

        function stopTimer(id) {
            const task = tasks.find(t => t.id === id);
            if (task.interval) {
                clearInterval(task.interval);
                task.interval = null;
            }
            task.isRunning = false;
            
            if (task.timeRemaining > 0) {
                task.partial = true;
            }
            
            renderTasks();
        }

        function resetTimer(id) {
            const task = tasks.find(t => t.id === id);
            stopTimer(id);
            task.timeRemaining = 0;
            renderTasks();
        }

        function updateTimerDisplay(id) {
            const task = tasks.find(t => t.id === id);
            const display = document.getElementById(`timer-${id}`);
            if (display) {
                const mins = Math.floor(task.timeRemaining / 60);
                const secs = task.timeRemaining % 60;
                display.textContent = `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
            }
        }

        function toggleComplete(id) {
            const task = tasks.find(t => t.id === id);
            task.completed = !task.completed;
            
            if (task.completed) {
                task.partial = false;
                showCelebration();
            }
            
            renderTasks();
        }

        function togglePartial(id) {
            const task = tasks.find(t => t.id === id);
            task.partial = !task.partial;
            
            if (task.partial) {
                task.completed = false;
            }
            
            renderTasks();
        }

        function updateNotes(id, notes) {
            const task = tasks.find(t => t.id === id);
            task.notes = notes;
        }

        function showCountdown(callback) {
            const animation = document.getElementById('countdownAnimation');
            const text = document.getElementById('countdownText');
            const sequence = ['1!', '2!', '3!!', 'GO!!!'];
            let index = 0;

            animation.style.display = 'flex';

            function showNext() {
                if (index < sequence.length) {
                    text.textContent = sequence[index];
                    text.style.animation = 'none';
                    setTimeout(() => {
                        text.style.animation = 'pulse 1s ease-in-out';
                    }, 10);
                    index++;
                    setTimeout(showNext, 1000);
                } else {
                    animation.style.display = 'none';
                    callback();
                }
            }

            showNext();
        }

        function showCelebration() {
            const celebration = document.getElementById('celebration');
            celebration.style.display = 'flex';
            
            // Play success tune
            playSuccessTune();
            
            setTimeout(() => {
                celebration.style.display = 'none';
            }, 2000);
        }

        function playSuccessTune() {
            try {
                // Create a synth
                const synth = new Tone.Synth({
                    oscillator: {
                        type: 'triangle'
                    },
                    envelope: {
                        attack: 0.05,
                        decay: 0.1,
                        sustain: 0.3,
                        release: 1
                    }
                }).toDestination();

                // Success melody (happy tune)
                const now = Tone.now();
                synth.triggerAttackRelease('C5', '8n', now);
                synth.triggerAttackRelease('E5', '8n', now + 0.15);
                synth.triggerAttackRelease('G5', '8n', now + 0.3);
                synth.triggerAttackRelease('C6', '4n', now + 0.45);
            } catch (error) {
                console.log('Audio not available');
            }
        }

        function renderTasks() {
            const taskList = document.getElementById('taskList');
            taskList.innerHTML = tasks.map(task => {
                const mins = Math.floor(task.timeRemaining / 60);
                const secs = task.timeRemaining % 60;
                const timerDisplay = `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;

                return `
                    <div class="task-item ${task.completed ? 'completed' : ''} ${task.partial ? 'partial' : ''}">
                        <div class="task-header">
                            <div class="task-name">${task.name}</div>
                            <button class="delete-btn" onclick="deleteTask(${task.id})">üóëÔ∏è</button>
                        </div>
                        
                        <div class="timer-section">
                            <input type="number" id="min-${task.id}" placeholder="Min" min="0" value="${task.minutes}" ${task.isRunning ? 'disabled' : ''}>
                            <span>:</span>
                            <input type="number" id="sec-${task.id}" placeholder="Sec" min="0" max="59" value="${task.seconds}" ${task.isRunning ? 'disabled' : ''}>
                            <button class="btn ${task.isRunning ? 'btn-stop' : 'btn-start'}" onclick="${task.isRunning ? 'stopTimer' : 'startTimer'}(${task.id})">
                                ${task.isRunning ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è'}
                            </button>
                            <button class="btn btn-reset" onclick="resetTimer(${task.id})">üîÑ</button>
                            <div class="timer-display" id="timer-${task.id}">${timerDisplay}</div>
                        </div>
                        
                        <div class="completion-section">
                            <div class="checkbox-wrapper">
                                <input type="checkbox" id="check-${task.id}" ${task.completed ? 'checked' : ''} onchange="toggleComplete(${task.id})">
                                <label for="check-${task.id}">‚úÖ Completed</label>
                            </div>
                            <div class="checkbox-wrapper">
                                <input type="checkbox" id="partial-${task.id}" ${task.partial ? 'checked' : ''} onchange="togglePartial(${task.id})">
                                <label for="partial-${task.id}">‚è±Ô∏è Partially Done</label>
                            </div>
                            <input type="text" class="notes-input" placeholder="${task.partial ? 'Why was this partial?' : 'Any notes?'}" value="${task.notes}" onchange="updateNotes(${task.id}, this.value)">
                        </div>
                    </div>
                `;
            }).join('');
        }

        let barChart = null;
        let pieChart = null;

        function showAnalytics() {
            const completedTasks = tasks.filter(t => t.completed);
            const partialTasks = tasks.filter(t => t.partial);
            
            if (completedTasks.length === 0 && partialTasks.length === 0) {
                alert('‚è≥ Please complete or partially complete at least one task!');
                return;
            }
            
            const modal = document.getElementById('analyticsModal');
            modal.style.display = 'flex';
            
            generateAnalytics();
        }

        function closeAnalytics() {
            const modal = document.getElementById('analyticsModal');
            modal.style.display = 'none';
        }

        function generateAnalytics() {
            const completedTasks = tasks.filter(t => t.completed);
            const partialTasks = tasks.filter(t => t.partial);
            const totalTasks = tasks.length;
            const completionRate = totalTasks > 0 ? Math.round((completedTasks.length / totalTasks) * 100) : 0;

            const statsGrid = document.getElementById('statsGrid');
            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${completedTasks.length}</div>
                    <div class="stat-label">Completed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${partialTasks.length}</div>
                    <div class="stat-label">Partial</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${totalTasks - completedTasks.length - partialTasks.length}</div>
                    <div class="stat-label">Pending</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${completionRate}%</div>
                    <div class="stat-label">Rate</div>
                </div>
            `;

            const barCtx = document.getElementById('barChart').getContext('2d');
            if (barChart) barChart.destroy();
            
            barChart = new Chart(barCtx, {
                type: 'bar',
                data: {
                    labels: tasks.map(t => t.name),
                    datasets: [{
                        label: 'Status',
                        data: tasks.map(t => t.completed ? 100 : t.partial ? 50 : 0),
                        backgroundColor: tasks.map(t => t.completed ? '#52c41a' : t.partial ? '#faad14' : '#ff4d4f'),
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });

            const pieCtx = document.getElementById('pieChart').getContext('2d');
            if (pieChart) pieChart.destroy();
            
            const taskTimes = tasks.map(t => {
                const mins = (t.minutes || 0) + ((t.seconds || 0) / 60);
                return mins > 0 ? mins : 5;
            });

            pieChart = new Chart(pieCtx, {
                type: 'pie',
                data: {
                    labels: tasks.map(t => t.name),
                    datasets: [{
                        data: taskTimes,
                        backgroundColor: ['#667eea', '#f46b45', '#11998e', '#eb3349', '#2193b0', '#f093fb', '#4facfe', '#43e97b']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });

            generateCompliments(completionRate, completedTasks.length);
            generatePartialReasons(partialTasks);
            generateSuggestions(completionRate, tasks);
        }

        function generateCompliments(rate, completed) {
            const complimentsSection = document.getElementById('complimentsSection');
            const partialTasks = tasks.filter(t => t.partial);
            let compliments = [];

            if (rate === 100) {
                compliments = ["üåü OUTSTANDING! Perfect completion!", "üèÜ You're a productivity champion!"];
            } else if (rate >= 75) {
                compliments = ["üéâ Excellent work!", "‚≠ê Great job!"];
            } else if (rate >= 50) {
                compliments = ["üëç Good effort!", "üíö You're on track!"];
            } else if (rate >= 25 || partialTasks.length > 0) {
                compliments = ["üåü Every step counts!", "üí´ Progress is progress!"];
                if (partialTasks.length > 0) {
                    compliments.push("üí™ Partial progress is still progress!");
                }
            } else {
                compliments = ["üí™ You've got this!", "üåà Tomorrow is a new day!"];
            }

            complimentsSection.innerHTML = `<h3>üéä Compliments</h3>` + compliments.map(c => `<div class="compliment-item">${c}</div>`).join('');
        }

        function generatePartialReasons(partialTasks) {
            const partialReasonsSection = document.getElementById('partialReasonsSection');
            
            if (partialTasks.length === 0) {
                partialReasonsSection.style.display = 'none';
                return;
            }
            
            partialReasonsSection.style.display = 'block';
            
            const tasksWithReasons = partialTasks.filter(t => t.notes && t.notes.trim() !== '');
            const tasksWithoutReasons = partialTasks.filter(t => !t.notes || t.notes.trim() === '');
            
            let content = '<h3>‚è±Ô∏è Partial Analysis</h3>';
            
            if (tasksWithReasons.length > 0) {
                tasksWithReasons.forEach(task => {
                    content += `<div class="partial-reason-item"><strong>${task.name}:</strong> ${task.notes}</div>`;
                });
            }
            
            if (tasksWithoutReasons.length > 0) {
                content += '<div style="margin-top: 10px; color: #fa8c16;"><strong>‚ö†Ô∏è Add reasons for:</strong></div>';
                tasksWithoutReasons.forEach(task => {
                    content += `<div class="partial-reason-item"><strong>${task.name}</strong></div>`;
                });
            }
            
            partialReasonsSection.innerHTML = content;
        }

        function generateSuggestions(rate, tasks) {
            const suggestionsSection = document.getElementById('suggestionsSection');
            const incompleteTasks = tasks.filter(t => !t.completed && !t.partial);
            const partialTasks = tasks.filter(t => t.partial);
            let suggestions = [];

            if (rate === 100) {
                suggestions = ["üí° Add more challenging tasks!", "üìà Track progress over time!"];
            } else {
                if (partialTasks.length > 0) {
                    suggestions.push(`‚ö†Ô∏è ${partialTasks.length} partial task(s). Try to finish next time!`);
                    suggestions.push("üìù Set realistic time estimates");
                }
                
                if (incompleteTasks.length > 0) {
                    suggestions.push(`‚è∞ Focus on: ${incompleteTasks.map(t => t.name).join(', ')}`);
                }
                
                suggestions.push("üïê Break large tasks into smaller chunks");
            }

            suggestions.push("üìä Review analytics daily");
            suggestions.push("üßò Take breaks for better focus");

            suggestionsSection.innerHTML = `<h3>üí° Suggestions</h3>` + suggestions.map(s => `<div class="suggestion-item">${s}</div>`).join('');
        }

        initializeTasks();
        updateYearCountdown();
    </script>
</body>
</html>
